<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ShareHive - Expense Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: Arial, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      transition: 0.3s;
    }
    :root {
      --bg-color: #ffffff;
      --text-color: #222;
      --primary-color: #0077ff;
      --sidebar-bg: #f4f4f4;
      --card-bg: #f8f8f8;
    }
    body.dark {
      --bg-color: #1e1e1e;
      --text-color: #f0f0f0;
      --sidebar-bg: #2c2c2c;
      --card-bg: #333333;
    }

    .navbar { display: flex; justify-content: space-between; align-items: center; padding: 10px 20px; background: var(--primary-color); color: white; }
    .navbar h1 { font-size: 20px; }
    .toggle-btn { background: white; border: none; color: var(--primary-color); padding: 5px 10px; border-radius: 5px; cursor: pointer; font-weight: bold; }

    .container { display: flex; height: calc(100vh - 50px); }

    .sidebar { width: 220px; background: var(--sidebar-bg); padding: 20px; overflow-y: auto; }
    .sidebar h2 { font-size: 16px; margin-bottom: 10px; }
    .sidebar a { display: block; text-decoration: none; color: var(--text-color); padding: 8px 10px; border-radius: 5px; margin-bottom: 5px; }
    .sidebar a:hover { background: var(--primary-color); color: white; }

    .main { flex: 1; padding: 20px; overflow-y: auto; }
    h2 { margin: 15px 0; }

    .form, .filters { margin-bottom: 20px; display: grid; gap: 10px; max-width: 500px; }
    .form input, .form select, .filters input, .filters select {
      padding: 8px; font-size: 14px;
      border: 1px solid #ccc; border-radius: 5px;
      background: var(--card-bg); color: var(--text-color);
    }
    .form button, .filters button {
      padding: 8px; border: none; background: var(--primary-color);
      color: white; border-radius: 5px; cursor: pointer; font-weight: bold;
    }

    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 10px; border-bottom: 1px solid #ccc; text-align: left; }
    th { background: var(--primary-color); color: white; }
    tr:hover { background: var(--card-bg); }

    .delete { background: #f44336; color: white; border: none; padding: 5px 8px; border-radius: 5px; cursor: pointer; }

    .summary {
      margin-top: 20px;
      padding: 15px;
      background: var(--card-bg);
      border-radius: 10px;
      font-size: 18px;
      font-weight: bold;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .chart-container {
      margin-top: 30px;
      max-width: 600px;
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <div class="navbar">
    <h1>ğŸ ShareHive - Expense Tracker</h1>
    <button class="toggle-btn" onclick="toggleTheme()">ğŸŒ™</button>
  </div>

  <div class="container">
    <!-- Sidebar -->
    <div class="sidebar">
      <h2>Menu</h2>
      <a href="index.html">ğŸ  Dashboard</a>
      <a href="notes.html">ğŸ“ Notes</a>
      <a href="bookmarks.html">ğŸ”– Bookmarks</a>
      <a href="videos.html">ğŸ¬ Video Links</a>
      <a href="todo.html">âœ… To-Do List</a>
      <a href="expense.html">ğŸ’° Expense Tracker</a>
      <a href="planner.html">ğŸ“… Planner</a>
      <a href="wiki.html">ğŸ“– Wiki</a>
      <a href="uploads.html">ğŸ“‚ Upload Files</a>
      <a href="projects.html">ğŸ“Œ Projects</a>
      <a href="watchlist.html">ğŸ¥ Watchlist</a>
      <a href="courses.html">ğŸ“š Courses</a>
      <a href="profile.html">ğŸ‘¤ Profile</a>
      <a href="settings.html">âš™ï¸ Settings</a>
      <hr>
      <a href="about.html">â„¹ï¸ About</a>
      <a href="help.html">â“ Help</a>
      <a href="faq.html">â” FAQ</a>
      <a href="blog.html">ğŸ“° Blog</a>
      <a href="contact.html">âœ‰ï¸ Contact</a>
      <a href="join.html">ğŸ¤ Join Us</a>
      <a href="report.html">ğŸ Report</a>
      <a href="privacy.html">ğŸ“œ Privacy & Policy</a>
      <a href="community.html">ğŸŒ Community</a>
    </div>

    <!-- Main -->
    <div class="main">
      <h2>Add Expense</h2>
      <div class="form">
        <input type="text" id="title" placeholder="Expense title">
        <input type="number" id="amount" placeholder="Amount">
        <select id="category">
          <option value="General">General</option>
          <option value="Food">Food</option>
          <option value="Transport">Transport</option>
          <option value="Shopping">Shopping</option>
          <option value="Bills">Bills</option>
          <option value="Other">Other</option>
        </select>
        <input type="date" id="date">
        <button id="saveBtn">Save Expense</button>
      </div>

      <h2>Filter Expenses</h2>
      <div class="filters">
        <select id="filterCategory">
          <option value="All">All Categories</option>
          <option value="General">General</option>
          <option value="Food">Food</option>
          <option value="Transport">Transport</option>
          <option value="Shopping">Shopping</option>
          <option value="Bills">Bills</option>
          <option value="Other">Other</option>
        </select>
        <input type="date" id="fromDate">
        <input type="date" id="toDate">
        <button onclick="applyFilters()">Apply Filters</button>
        <button onclick="clearFilters()">Clear Filters</button>
      </div>

      <h2>Your Expenses</h2>
      <table>
        <thead>
          <tr>
            <th>Title</th>
            <th>Amount</th>
            <th>Category</th>
            <th>Date</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="expenses"></tbody>
      </table>

      <div class="summary">
        Total Expenses: $<span id="total">0.00</span>
      </div>

      <div class="chart-container">
        <h2>Expense Breakdown (by Category)</h2>
        <canvas id="expensePieChart"></canvas>
      </div>

      <div class="chart-container">
        <h2>Monthly Spending Trends</h2>
        <canvas id="expenseBarChart"></canvas>
      </div>
    </div>
  </div>

  <script>
    // ğŸŒ™ Dark mode
    function toggleTheme() {
      document.body.classList.toggle("dark");
      localStorage.setItem("theme", document.body.classList.contains("dark") ? "dark" : "light");
    }
    if (localStorage.getItem("theme") === "dark") document.body.classList.add("dark");

 // ğŸ“¦ IndexedDB (v21 unified)
let db;
const stores = [
  "notes",
  "bookmarks",
  "videos",
  "todos",
  "expenses",
  "planner",
  "wiki",
  "uploads",
  "projects",
  "watchlist",
  "courses",
  "profile",
  "settings",
  "community"
];

const request = indexedDB.open("ShareHiveDB", 21);

request.onupgradeneeded = e => {
  db = e.target.result;
  stores.forEach(name => {
    if (!db.objectStoreNames.contains(name)) {
      db.createObjectStore(name, { keyPath: "id", autoIncrement: true });
    }
  });
};

request.onsuccess = e => { 
  db = e.target.result; 
  displayExpenses();  // âœ… call page-specific display function
};

request.onerror = e => console.error("DB error:", e.target.error);


    // Save expense
    document.getElementById("saveBtn").onclick = () => {
      const title = document.getElementById("title").value.trim();
      const amount = parseFloat(document.getElementById("amount").value);
      const category = document.getElementById("category").value;
      const date = document.getElementById("date").value;

      if (!title || isNaN(amount) || !date) return;

      const tx = db.transaction("expenses", "readwrite");
      tx.objectStore("expenses").add({ title, amount, category, date });

      tx.oncomplete = () => {
        document.getElementById("title").value = "";
        document.getElementById("amount").value = "";
        document.getElementById("category").value = "General";
        document.getElementById("date").value = "";
        displayExpenses();
      };
    };

    // Display expenses with filters
    function displayExpenses() {
      const tx = db.transaction("expenses", "readonly");
      const req = tx.objectStore("expenses").getAll();

      req.onsuccess = () => {
        const tbody = document.getElementById("expenses");
        const totalEl = document.getElementById("total");
        tbody.innerHTML = "";
        let total = 0;
        let categoryTotals = {};
        let monthlyTotals = {};

        let categoryFilter = document.getElementById("filterCategory").value;
        let fromDate = document.getElementById("fromDate").value;
        let toDate = document.getElementById("toDate").value;

        req.result.forEach(exp => {
          // Apply category filter
          if (categoryFilter !== "All" && exp.category !== categoryFilter) return;

          // Apply date filter
          if (fromDate && exp.date < fromDate) return;
          if (toDate && exp.date > toDate) return;

          total += exp.amount;
          categoryTotals[exp.category] = (categoryTotals[exp.category] || 0) + exp.amount;

          const month = exp.date.slice(0, 7); // YYYY-MM
          monthlyTotals[month] = (monthlyTotals[month] || 0) + exp.amount;

          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${exp.title}</td>
            <td>$${exp.amount.toFixed(2)}</td>
            <td>${exp.category}</td>
            <td>${exp.date}</td>
            <td><button class="delete" onclick="deleteExpense(${exp.id})">Delete</button></td>
          `;
          tbody.appendChild(tr);
        });

        totalEl.textContent = total.toFixed(2);
        updateCharts(categoryTotals, monthlyTotals);
      };
    }

    // Apply filters
    function applyFilters() { displayExpenses(); }

    // Clear filters
    function clearFilters() {
      document.getElementById("filterCategory").value = "All";
      document.getElementById("fromDate").value = "";
      document.getElementById("toDate").value = "";
      displayExpenses();
    }

    // Delete expense
    function deleteExpense(id) {
      const tx = db.transaction("expenses", "readwrite");
      tx.objectStore("expenses").delete(id);
      tx.oncomplete = displayExpenses;
    }

    // ğŸ“Š Charts
    let pieChart, barChart;
    function updateCharts(categoryTotals, monthlyTotals) {
      const pieCtx = document.getElementById("expensePieChart").getContext("2d");
      const barCtx = document.getElementById("expenseBarChart").getContext("2d");

      // Pie chart (categories)
      const pieData = {
        labels: Object.keys(categoryTotals),
        datasets: [{
          data: Object.values(categoryTotals),
          backgroundColor: ["#0077ff", "#4caf50", "#ff9800", "#9c27b0", "#f44336", "#795548"]
        }]
      };
      if (pieChart) pieChart.destroy();
      pieChart = new Chart(pieCtx, { type: "pie", data: pieData, options: { responsive: true, plugins: { legend: { position: "bottom" } } } });

      // Bar chart (monthly)
      const months = Object.keys(monthlyTotals).sort();
      const barData = {
        labels: months,
        datasets: [{
          label: "Monthly Spending",
          data: months.map(m => monthlyTotals[m]),
          backgroundColor: "#0077ff"
        }]
      };
      if (barChart) barChart.destroy();
      barChart = new Chart(barCtx, { type: "bar", data: barData, options: { responsive: true, scales: { y: { beginAtZero: true } } } });
    }
  </script>
</body>
</html>
