<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <script src="./db.js"></script>
  <title>ShareHive - Courses</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      transition:0.3s;
    }
    :root {
      --bg-color:#ffffff;
      --text-color:#222;
      --primary-color:#0077ff;
      --secondary-color:#00c896;
      --sidebar-bg:#f4f4f4;
      --card-bg:#f8f8f8;
      --border-color:#e0e0e0;
      --success-color:#28a745;
      --warning-color:#ffc107;
      --danger-color:#dc3545;
      --info-color:#17a2b8;
    }
    body.dark {
      --bg-color:#1e1e1e;
      --text-color:#f0f0f0;
      --sidebar-bg:#2c2c2c;
      --card-bg:#333333;
      --border-color:#444;
    }

    .navbar { 
      display:flex; justify-content:space-between; align-items:center; 
      padding:10px 20px; background:linear-gradient(135deg, var(--primary-color), #0056cc); color:white; 
      box-shadow:0 2px 10px rgba(0,0,0,0.1);
    }
    .navbar h1 { font-size:20px; }
    .toggle-btn { 
      background:white; border:none; color:var(--primary-color); 
      padding:8px 15px; border-radius:20px; cursor:pointer; font-weight:bold;
      transition:all 0.3s ease; box-shadow:0 2px 5px rgba(0,0,0,0.2);
    }
    .toggle-btn:hover {
      transform:scale(1.05);
      box-shadow:0 3px 8px rgba(0,0,0,0.3);
    }

    .container { display:flex; height:calc(100vh - 50px); }

    .sidebar { 
      width:220px; background:var(--sidebar-bg); padding:20px; overflow-y:auto;
      border-right:1px solid var(--border-color);
    }
    .sidebar h2 { font-size:16px; margin-bottom:10px; }
    .sidebar a { 
      display:block; text-decoration:none; color:var(--text-color); 
      padding:8px 10px; border-radius:5px; margin-bottom:5px;
      transition:all 0.3s ease;
    }
    .sidebar a:hover { 
      background:var(--primary-color); color:white;
      transform:translateX(5px);
    }

    .main { 
      flex:1; 
      padding:30px; 
      overflow-y:auto;
      background:var(--bg-color);
    }

    /* Page Header */
    .page-header {
      display:flex; justify-content:space-between; align-items:center;
      margin-bottom:30px; padding-bottom:20px;
      border-bottom:2px solid var(--border-color);
    }

    .page-header h2 {
      font-size:32px; color:var(--text-color);
      display:flex; align-items:center; gap:10px;
    }
    
    .btn {
      padding:12px 30px; border:none; border-radius:25px; font-weight:bold;
      cursor:pointer; transition:all 0.3s ease; font-size:16px;
      display:flex; align-items:center; gap:8px;
    }

    .btn-primary {
      background:var(--primary-color); color:white;
      box-shadow:0 4px 10px rgba(0,119,255,0.3);
    }

    .btn-primary:hover {
      background:#0056cc; transform:translateY(-2px);
      box-shadow:0 6px 20px rgba(0,119,255,0.4);
    }

    /* Add Course Form */
    .form-card {
      background:var(--card-bg); padding:30px; border-radius:15px;
      margin-bottom:30px; border:2px solid var(--border-color);
      box-shadow:0 4px 15px rgba(0,0,0,0.08); display:none;
    }

    .form-card.show {
      display:block; animation:slideDown 0.3s ease-out;
    }
    
    @keyframes slideDown {
      from { opacity:0; transform:translateY(-20px); }
      to { opacity:1; transform:translateY(0); }
    }

    .form-card h3 {
      font-size:24px; margin-bottom:20px; color:var(--primary-color);
      display:flex; align-items:center; gap:10px;
    }

    .form-grid {
      display:grid; grid-template-columns:1fr 1fr; gap:20px;
    }

    .form-group { margin-bottom:20px; }
    .form-group.full-width { grid-column:1 / -1; }

    .form-group label {
      display:block; margin-bottom:8px; font-weight:600; font-size:14px;
    }

    .form-group input, .form-group textarea, .form-group select {
      width:100%; padding:12px 15px; border:2px solid var(--border-color);
      border-radius:10px; background:var(--bg-color); color:var(--text-color);
      font-size:15px; transition:all 0.3s ease; font-family:inherit;
    }

    .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
      outline:none; border-color:var(--primary-color);
      box-shadow:0 0 0 3px rgba(0,119,255,0.1);
    }
    
    .form-group textarea { min-height:100px; resize:vertical; }

    .form-actions { display:flex; gap:15px; margin-top:10px; }
    .btn-secondary { background:var(--border-color); color:var(--text-color); }
    .btn-secondary:hover { background:#ccc; }

    /* Filter/Search Bar */
    .filter-bar {
      display:grid; grid-template-columns:2fr 1fr; gap:20px;
      margin-bottom:30px;
    }

    .search-container { position:relative; }
    .search-box {
      width:100%; padding:15px 45px 15px 20px; font-size:16px;
      border:2px solid var(--border-color); border-radius:10px;
      background:var(--card-bg); color:var(--text-color);
    }
    .search-icon { position:absolute; right:15px; top:50%; transform:translateY(-50%); opacity:0.5; }

    /* Course Cards */
    .courses-container {
      display:grid; grid-template-columns:repeat(auto-fill, minmax(320px, 1fr)); gap:20px;
    }

    .course-card {
      background:var(--card-bg); border-radius:15px; border:2px solid var(--border-color);
      box-shadow:0 4px 15px rgba(0,0,0,0.08); transition:all 0.3s ease;
      animation:fadeInUp 0.6s ease-out backwards;
    }

    .course-card:hover {
      transform:translateY(-5px); box-shadow:0 8px 25px rgba(0,0,0,0.12);
      border-color:var(--primary-color);
    }
    
    .course-header {
      padding:20px; border-bottom:1px solid var(--border-color);
    }

    .course-title {
      font-size:20px; margin-bottom:8px; color:var(--text-color);
    }

    .course-platform {
      font-size:14px; font-weight:600; opacity:0.7;
    }

    .course-body { padding:20px; }

    .course-desc {
      font-size:14px; line-height:1.6; opacity:0.9; margin-bottom:15px;
    }

    .progress-section { margin-bottom:15px; }
    .progress-bar {
      width:100%; height:12px; background:var(--border-color); border-radius:6px;
      overflow:hidden;
    }
    .progress-fill {
      height:100%; width:0; border-radius:6px; transition:width 0.3s ease;
    }
    .progress-fill.not-started { background:var(--border-color); }
    .progress-fill.in-progress { background:var(--primary-color); }
    .progress-fill.completed { background:var(--success-color); }
    .progress-text { font-size:12px; font-weight:600; margin-top:5px; opacity:0.7; }
    
    .course-details {
      display:grid; grid-template-columns:1fr 1fr; gap:10px;
      font-size:13px; margin-bottom:20px;
    }

    .detail-item { display:flex; align-items:center; gap:5px; opacity:0.8; }
    
    .lessons-section h4 { margin-bottom:10px; font-size:15px; }
    .lessons-list {
      max-height:150px; overflow-y:auto; padding-right:10px;
    }
    .lesson-item {
      display:flex; align-items:center; gap:8px; padding:8px 0;
    }
    .lesson-item input[type="checkbox"] { width:16px; height:16px; cursor:pointer; }
    .lesson-item label { flex:1; cursor:pointer; }
    .lesson-item label.completed { text-decoration:line-through; opacity:0.6; }

    .course-footer {
      padding:15px 20px; border-top:1px solid var(--border-color);
      display:flex; flex-wrap:wrap; gap:10px;
    }
    
    .action-btn {
      padding:8px 15px; border:none; border-radius:20px; cursor:pointer;
      font-size:13px; font-weight:600; transition:all 0.3s ease;
      display:flex; align-items:center; gap:5px;
    }
    .btn-edit { background:var(--info-color); color:white; }
    .btn-delete { background:var(--danger-color); color:white; }
    .btn-lesson { background:var(--secondary-color); color:white; }
    .action-btn:hover { opacity:0.8; transform:scale(1.05); }

    /* Calendar */
    .calendar-card {
      background:var(--card-bg); padding:30px; border-radius:15px; margin-top:40px;
      border:2px solid var(--border-color); box-shadow:0 4px 15px rgba(0,0,0,0.08);
    }
    .calendar-card h2 {
      margin-bottom:20px; display:flex; align-items:center; gap:10px;
    }
    #calendarList li {
      padding:10px 0; border-bottom:1px solid var(--border-color);
      display:flex; justify-content:space-between;
    }
    #calendarList li:last-child { border-bottom:none; }
    .deadline-date { font-weight:bold; color:var(--primary-color); }

    /* Modal */
    .modal {
      display:none; position:fixed; top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,0.7); z-index:1000; align-items:center; justify-content:center;
    }
    .modal.show { display:flex; }
    .modal-content {
      background:var(--card-bg); padding:30px; border-radius:15px;
      max-width:400px; width:90%; box-shadow:0 10px 40px rgba(0,0,0,0.3);
      animation:slideIn 0.3s ease-out;
    }
    .modal-content h3 { margin-bottom:15px; }
    .modal-content input {
      width:100%; padding:12px; border:2px solid var(--border-color);
      border-radius:10px; margin-bottom:15px;
    }
    
    /* Responsive */
    @media (max-width:968px) {
      .form-grid { grid-template-columns:1fr; }
      .filter-bar { grid-template-columns:1fr; }
    }
    
    @media (max-width:768px) {
      .container { flex-direction:column; }
      .sidebar { width:100%; }
      .main { padding:20px; }
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <div class="navbar">
    <h1>üêù ShareHive - Courses</h1>
    <button class="toggle-btn" onclick="toggleTheme()">üåô</button>
  </div>
  
  <!-- Modal for adding lessons -->
  <div class="modal" id="lessonModal">
    <div class="modal-content">
      <h3>Add New Lesson</h3>
      <input type="text" id="lessonInput" placeholder="Enter lesson name...">
      <div class="form-actions">
        <button class="btn btn-primary" id="saveLessonBtn">Save Lesson</button>
        <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- Sidebar -->
    <div class="sidebar">
      <h2>Menu</h2>
      <a href="index.html">üè† Dashboard</a>
      <a href="notes.html">üìù Notes</a>
      <a href="bookmarks.html">üîñ Bookmarks</a>
      <a href="videos.html">üé¨ Video Links</a>
      <a href="expense.html">üí∞ Expense Tracker</a>
      <a href="planner.html">üìÖ Planner</a>
      <a href="uploads.html">üìÇ Upload Files</a>
      <a href="projects.html">üìå Projects</a>
      <a href="watchlist.html">üé• Watchlist</a>
      <a href="courses.html"><b>üìö Courses</b></a>
      <a href="profile.html">üë§ Profile</a>
      <a href="settings.html">‚öôÔ∏è Settings</a>
      <hr>
      <a href="about.html">‚ÑπÔ∏è About</a>
      <a href="help.html">‚ùì Help</a>
      <a href="faq.html">‚ùî FAQ</a>
      <a href="blog.html">üì∞ Blog</a>
      <a href="contact.html">‚úâÔ∏è Contact</a>
      <a href="join.html">ü§ù Join Us</a>
      <a href="report.html">üêû Report</a>
      <a href="privacy.html">üìú Privacy & Policy</a>
      <a href="community.html">üåç Community</a>
    </div>

    <!-- Main -->
    <div class="main">
      <div class="page-header">
        <h2>üìö My Learning Journey</h2>
        <button class="btn btn-primary" onclick="toggleForm()">
          <span>‚ûï</span>
          <span>Add New Course</span>
        </button>
      </div>

      <!-- Add Course Form Card -->
      <div class="form-card" id="addCourseForm">
        <h3>
          <span id="formIcon">‚ûï</span>
          <span id="formTitle">Add New Course</span>
        </h3>
        <form id="courseForm">
          <input type="hidden" id="courseId">
          <div class="form-grid">
            <div class="form-group">
              <label for="title">Course Title *</label>
              <input type="text" id="title" placeholder="e.g., JavaScript for Beginners" required>
            </div>
            <div class="form-group">
              <label for="platform">Platform</label>
              <input type="text" id="platform" placeholder="e.g., Udemy, YouTube">
            </div>
          </div>
          <div class="form-group full-width">
            <label for="link">Course Link</label>
            <input type="url" id="link" placeholder="https://...">
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="category">Category</label>
              <input type="text" id="category" placeholder="e.g., Web Development">
            </div>
            <div class="form-group">
              <label for="status">Status</label>
              <select id="status">
                <option value="not-started">Not Started</option>
                <option value="in-progress">In Progress</option>
                <option value="completed">Completed</option>
              </select>
            </div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="startDate">Start Date</label>
              <input type="date" id="startDate">
            </div>
            <div class="form-group">
              <label for="endDate">End Date</label>
              <input type="date" id="endDate">
            </div>
          </div>
          <div class="form-group full-width">
            <label for="desc">Description</label>
            <textarea id="desc" placeholder="A brief summary of the course..."></textarea>
          </div>
          <div class="form-group full-width">
            <label for="certificate">Certificate</label>
            <input type="file" id="certificate" accept="image/*, application/pdf">
          </div>
          <div class="form-actions">
            <button type="submit" class="btn btn-primary" id="saveBtn">Save Course</button>
            <button type="button" class="btn btn-secondary" onclick="toggleForm()">Cancel</button>
          </div>
        </form>
      </div>

      <!-- Filter/Search Bar -->
      <div class="filter-bar">
        <div class="search-container">
          <input type="text" id="search" class="search-box" placeholder="Search courses by title or platform...">
          <span class="search-icon">üîç</span>
        </div>
        <select id="filter" class="search-box">
          <option value="all">Filter by Status: All</option>
          <option value="not-started">Not Started</option>
          <option value="in-progress">In Progress</option>
          <option value="completed">Completed</option>
        </select>
      </div>

      <!-- Courses Grid -->
      <div class="courses-container" id="coursesContainer"></div>

      <!-- Calendar Card -->
      <div class="calendar-card">
        <h2>üìÖ Upcoming Deadlines</h2>
        <ul id="calendarList"></ul>
      </div>
    </div>
  </div>

  <script>
    // üåô Dark Mode
    function toggleTheme(){
      document.body.classList.toggle("dark");
      localStorage.setItem("theme", document.body.classList.contains("dark") ? "dark":"light");
    }
    if(localStorage.getItem("theme")==="dark") document.body.classList.add("dark");

    // üì¶ IndexedDB (v21 unified)
    let db;
    const stores = ["notes","bookmarks","videos","todos","expenses","planner","wiki","uploads","projects","watchlist","courses","profile","community"];
    const request = indexedDB.open("ShareHiveDB", 22);

    request.onupgradeneeded = e => {
      db = e.target.result;
      stores.forEach(name => {
        if (!db.objectStoreNames.contains(name)) {
          db.createObjectStore(name, { keyPath: "id", autoIncrement: true });
        }
      });
    };
    
    request.onsuccess = e => { 
      db = e.target.result; 
      loadAndDisplayCourses();
    };
    
    request.onerror = e => console.error("DB error:", e.target.error);

    let editingCourseId = null;

    // Toggle Form Visibility
    function toggleForm() {
      const formCard = document.getElementById('addCourseForm');
      const isVisible = formCard.classList.toggle('show');
      if (!isVisible) clearForm();
    }
    
    // Form Submission
    document.getElementById('courseForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const title = document.getElementById('title').value.trim();
      if (!title) return;

      const file = document.getElementById('certificate').files[0];
      let certificateData = null;
      if (file) {
        certificateData = await toBase64(file);
      }

      const course = {
        title,
        platform: document.getElementById('platform').value,
        link: document.getElementById('link').value,
        category: document.getElementById('category').value,
        start: document.getElementById('startDate').value,
        end: document.getElementById('endDate').value,
        desc: document.getElementById('desc').value,
        status: document.getElementById('status').value,
        certificate: certificateData
      };
      
      if (editingCourseId) {
        // Update existing course
        const tx = db.transaction("courses", "readwrite");
        const store = tx.objectStore("courses");
        const req = store.get(editingCourseId);
        req.onsuccess = () => {
          const existingCourse = req.result;
          Object.assign(existingCourse, course);
          if (!certificateData) existingCourse.certificate = req.result.certificate; // keep old cert if no new one
          store.put(existingCourse);
        };
      } else {
        // Add new course
        course.lessons = [];
        course.progress = 0;
        const tx = db.transaction("courses", "readwrite");
        tx.objectStore("courses").add(course);
      }
      
      clearForm();
      toggleForm();
      loadAndDisplayCourses();
    });

    // Clear form
    function clearForm() {
      document.getElementById('courseForm').reset();
      document.getElementById('courseId').value = '';
      editingCourseId = null;
      document.getElementById('formTitle').textContent = 'Add New Course';
      document.getElementById('formIcon').textContent = '‚ûï';
    }

    // Load and Display Courses
    function loadAndDisplayCourses() {
      const tx = db.transaction("courses", "readonly");
      tx.objectStore("courses").getAll().onsuccess = e => {
        let courses = e.target.result;
        const search = document.getElementById("search").value.toLowerCase();
        const filter = document.getElementById("filter").value;
        
        courses = courses.filter(c =>
          (c.title.toLowerCase().includes(search) || c.platform.toLowerCase().includes(search)) &&
          (filter === "all" || c.status === filter)
        );
        
        renderCourses(courses);
        renderCalendar(courses);
      };
    }

    // Render Courses
    function renderCourses(courses) {
      const container = document.getElementById("coursesContainer");
      container.innerHTML = courses.map(c => `
        <div class="course-card">
          <div class="course-header">
            <h3 class="course-title">${c.title}</h3>
            <p class="course-platform">${c.platform}</p>
          </div>
          <div class="course-body">
            <p class="course-desc">${c.desc}</p>
            <div class="progress-section">
              <div class="progress-bar">
                <div class="progress-fill ${c.status}" style="width:${c.progress}%"></div>
              </div>
              <p class="progress-text">${c.status.replace('-', ' ')} - ${c.progress}%</p>
            </div>
            <div class="course-details">
              ${c.start ? `<div class="detail-item">üóìÔ∏è Start: ${c.start}</div>` : ''}
              ${c.end ? `<div class="detail-item">üèÅ End: ${c.end}</div>` : ''}
              ${c.link ? `<div class="detail-item"><a href="${c.link}" target="_blank">üîó Link</a></div>` : ''}
              ${c.certificate ? `<div class="detail-item"><a href="${c.certificate}" target="_blank">üéì Certificate</a></div>` : ''}
            </div>
            <div class="lessons-section">
              <h4>Lessons (${c.lessons.length})</h4>
              <div class="lessons-list">
                ${c.lessons.map((l, i) => `
                  <div class="lesson-item">
                    <input type="checkbox" id="lesson-${c.id}-${i}" ${l.done ? "checked" : ""} onchange="toggleLesson(${c.id}, ${i})">
                    <label for="lesson-${c.id}-${i}" class="${l.done ? 'completed' : ''}">${l.text}</label>
                  </div>
                `).join("")}
              </div>
            </div>
          </div>
          <div class="course-footer">
            <button class="action-btn btn-lesson" onclick="openLessonModal(${c.id})">‚ûï Add Lesson</button>
            <button class="action-btn btn-edit" onclick="editCourse(${c.id})">‚úèÔ∏è Edit</button>
            <button class="action-btn btn-delete" onclick="deleteCourse(${c.id})">üóëÔ∏è Delete</button>
          </div>
        </div>
      `).join('');
    }

    // Render Calendar
    function renderCalendar(courses) {
      const calList = document.getElementById("calendarList");
      const deadlines = courses.filter(c => c.end).sort((a, b) => new Date(a.end) - new Date(b.end));
      calList.innerHTML = deadlines.map(c => `
        <li>
          <span>${c.title}</span>
          <span class="deadline-date">${c.end}</span>
        </li>
      `).join('') || '<li>No upcoming deadlines.</li>';
    }

    // Course Actions
    function deleteCourse(id) {
      if (confirm('Are you sure you want to delete this course?')) {
        const tx = db.transaction("courses", "readwrite");
        tx.objectStore("courses").delete(id);
        tx.oncomplete = () => loadAndDisplayCourses();
      }
    }
    
    function editCourse(id) {
      const tx = db.transaction("courses", "readonly");
      tx.objectStore("courses").get(id).onsuccess = e => {
        const c = e.target.result;
        document.getElementById('courseId').value = c.id;
        document.getElementById('title').value = c.title;
        document.getElementById('platform').value = c.platform;
        document.getElementById('link').value = c.link;
        document.getElementById('category').value = c.category;
        document.getElementById('status').value = c.status;
        document.getElementById('startDate').value = c.start;
        document.getElementById('endDate').value = c.end;
        document.getElementById('desc').value = c.desc;
        
        editingCourseId = c.id;
        document.getElementById('formTitle').textContent = 'Edit Course';
        document.getElementById('formIcon').textContent = '‚úèÔ∏è';
        
        const formCard = document.getElementById('addCourseForm');
        if (!formCard.classList.contains('show')) {
          formCard.classList.add('show');
        }
        formCard.scrollIntoView({ behavior: 'smooth' });
      };
    }
    
    // Lesson Actions
    function openLessonModal(courseId) {
      const modal = document.getElementById('lessonModal');
      modal.classList.add('show');
      document.getElementById('lessonInput').focus();
      document.getElementById('saveLessonBtn').onclick = () => addLesson(courseId);
    }

    function closeModal() {
      document.getElementById('lessonModal').classList.remove('show');
      document.getElementById('lessonInput').value = '';
    }

    function addLesson(courseId) {
      const text = document.getElementById('lessonInput').value.trim();
      if (!text) return;

      const tx = db.transaction("courses", "readwrite");
      const store = tx.objectStore("courses");
      store.get(courseId).onsuccess = e => {
        const course = e.target.result;
        course.lessons.push({ text, done: false });
        updateCourseInDB(course);
      };
      closeModal();
    }
    
    function toggleLesson(courseId, index) {
      const tx = db.transaction("courses", "readwrite");
      const store = tx.objectStore("courses");
      store.get(courseId).onsuccess = e => {
        const course = e.target.result;
        course.lessons[index].done = !course.lessons[index].done;
        
        const done = course.lessons.filter(l => l.done).length;
        course.progress = course.lessons.length > 0 ? Math.round((done / course.lessons.length) * 100) : 0;
        
        if (course.progress === 100) course.status = "completed";
        else if (course.progress > 0) course.status = "in-progress";
        else course.status = "not-started";
        
        updateCourseInDB(course);
      };
    }

    function updateCourseInDB(course) {
      const tx = db.transaction("courses", "readwrite");
      tx.objectStore("courses").put(course);
      tx.oncomplete = () => loadAndDisplayCourses();
    }
    
    // Utility for file to base64
    const toBase64 = file => new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.readAsDataURL(file);
      reader.onload = () => resolve(reader.result);
      reader.onerror = error => reject(error);
    });

    // Event Listeners for search/filter
    document.getElementById("search").oninput = loadAndDisplayCourses;
    document.getElementById("filter").onchange = loadAndDisplayCourses;
  </script>
</body>
</html>